<% include layout/header %>

<div id="password-edit">

    <div class="container">

        <div class="col-sm-6 col-sm-offset-3">

            <a class="" href="<%= link('/auth/local') %>"><span
                        class="glyphicon glyphicon-chevron-left"></span><%= __('PASSWORD_EDIT_BACK_TO_LOGIN_LINK') %>
            </a>

            <div id="login-panel" class="panel panel-default">
                <div class="panel-body">
                    <h1 class="title">
                        <%= __('PASSWORD_EDIT_TITLE') %>
                    </h1>

                    <div id="verification-error" class="alert alert-danger error-message" role="alert"></div>
                    <div id="verification-success" class="alert alert-success error-message" role="alert">
                        <span class="glyphicon glyphicon-ok"></span>
                        <span class="text"><%= __('PASSWORD_EDIT_LOGIN_WITH_NEW_PASSWORD_LINK_PREFIX') %> <a
                                    href="<%= link('/auth/local') %>"><%= __('PASSWORD_EDIT_LOGIN_WITH_NEW_PASSWORD_LINK') %></a> </span>
                    </div>

                    <!-- LOGIN FORM -->
                    <form id="password-edit-form" action="<%= link('/password/update') %>" method="post">
                        <div class="form-group">
                            <label><%= __('PASSWORD_EDIT_NEW_PASSWORD_FORM_LABEL') %></label>
                            <input type="password" class="form-control" name="password">
                        </div>

                        <div class="form-group">
                            <label><%= __('PASSWORD_EDIT_CONFIRM_PASSWORD_FORM_LABEL') %></label>
                            <input type="password" class="form-control" name="confirm-password">
                        </div>

                        <button type="submit"
                                class="btn btn-primary btn-block"><%= __('PASSWORD_EDIT_CONFIRM_FORM_BUTTON') %></button>

                        <input type="hidden" name="email" value="<%= email %>">
                        <input type="hidden" name="code" value="<%= code %>">

                    </form>

                </div>
            </div>

        </div>

    </div>

</div>

<script type="text/javascript">
    (function () {
        var $verifSuccess = $("#verification-success");
        var $verifError = $("#verification-error");

        $('#password-edit-form').submit(function (e) {
            e.preventDefault();

            $verifError.hide();
            $verifSuccess.hide();

            $(this).ajaxSubmit({
                error: function (result) {
                    $verifError.empty();

                    if (result.responseJSON.errors) {
                        $.each(result.responseJSON.errors, function (index, error) {
                            $verifError.append($('<p>').text(error.msg));
                        });
                    } else if (!result.responseJSON.msg) {
                        $verifError.append($('<p>').text("<%= __('PASSWORD_EDIT_JS_ERROR_MSG') %>"));
                    } else {
                        $verifError.append($('<p>').text(result.responseJSON.msg));
                    }

                    $verifError.show();
                },
                success: function () {
                    $('#password-edit-form').remove();
                    $verifSuccess.show();
                }
            });
        });
    })();
</script>

<% include layout/foot %>
