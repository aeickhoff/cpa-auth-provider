<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>test login</title>
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>.nav-tabs {
        margin-bottom: 15px;
    }

    .sign-with {
        margin-top: 25px;
        padding: 20px;
    }

    div#OR {
        height: 30px;
        width: 30px;
        border: 1px solid #C2C2C2;
        border-radius: 50%;
        font-weight: bold;
        line-height: 28px;
        text-align: center;
        font-size: 12px;
        float: right;
        position: absolute;
        right: -16px;
        top: 40%;
        z-index: 1;
        background: #DFDFDF;
    }</style>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript">$('#myModal').modal('show');</script>
    <script src="https://www.google.com/recaptcha/api.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            $('#info_box').hide();


            var authenticate = function (email, password) {
                $.post("/api/local/authenticate", {email: email, password: password},
                        function (data, status, code) {
                            console.log(JSON.stringify(data) + " with status '" + status + "' and code  : " + code.status);
                            if (code.status === 200) {
                                $('#myModal').modal('hide');
                                $('#login_link').hide();
                                $('#info_box').show();
                                console.log("token :" + data.token);
                                getUserInfo(data.token);
                            } else {
                                //TODO
                            }
                        });
            }

            var register = function (email, password, captcha) {
                $.post("/api/local/signup", {email: email, password: password, "g-recaptcha-response": captcha},
                        function (data, status, code) {
                            console.log(JSON.stringify(data));
                            if (code.status === 200) {
                                authenticate(email, password);
                            } else {
                                //TODO
                            }
                        });
            }

            var getUserInfo = function (header) {
                $.ajax({
                    type: 'GET',
                    url: "/api/local/info",
                    headers: {
                        "authorization":header
                    }
                }).done(function(data) {
                    console.log("infos :" + JSON.stringify(data));
                });
            }

            $("#login").click(function () {
                var email = $("#login_email").val();
                var password = $("#login_password").val();
                authenticate(email, password);
            });

            $("#signup").click(function () {
                var email = $("#signup_email").val();
                var password = $("#signup_password").val();
                register(email, password, grecaptcha.getResponse());
            });

        });
    </script>
</head>
<body>
<!-- Large modal -->
<div id="login_link">
    <a href="#" data-toggle="modal" data-target="#myModal">login</a>
</div>
<div id="info_box">
    <p>info :


    </p>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    Ã—
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    Login/Registration </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8" style="border-right: 1px dotted #C2C2C2;padding-right: 30px;">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#Login" data-toggle="tab">Login</a></li>
                            <li><a href="#Registration" data-toggle="tab">Registration</a></li>
                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div class="tab-pane active" id="Login">
                                <form role="form" class="form-horizontal" action="#">
                                    <div class="form-group">
                                        <label for="login_email" class="col-sm-2 control-label">
                                            Email</label>
                                        <div class="col-sm-10">
                                            <input type="email" class="form-control" id="login_email" name="login_email"
                                                   placeholder="Email" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="login_password" class="col-sm-2 control-label">
                                            Password</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control" id="login_password"
                                                   name="login_password" placeholder="Password" required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-2">
                                        </div>
                                        <div class="col-sm-10">
                                            <button type="button" class="btn btn-primary btn-sm" name="login" id="login"
                                                    value="Login">
                                                Submit
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="tab-pane" id="Registration">
                                <form role="form" class="form-horizontal" action="/signup">
                                    <div class="form-group">
                                        <label for="signup_email" class="col-sm-2 control-label">
                                            Email</label>
                                        <div class="col-sm-10">
                                            <input type="email" class="form-control" id="signup_email"
                                                   name="signup_email" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="signup_password" class="col-sm-2 control-label">
                                            Password</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control" id="signup_password"
                                                   name="signup_password" placeholder="Password" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="signup_password2" class="col-sm-2 control-label">
                                            Confirm</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control" id="signup_password2"
                                                   name="signup_password2" placeholder="Password" required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-2">
                                        </div>
                                        <div class="col-sm-10">
                                            <div class="g-recaptcha"
                                                 data-sitekey="6Ld_UQcUAAAAAP-uEX-JVnu_kLpf17WQvIB-pXIX"></div>
                                            <!--<%= config.recaptcha.site_key %>-->

                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-2">
                                        </div>
                                        <div class="col-sm-10">
                                            <button type="button" class="btn btn-primary btn-sm" name="signup"
                                                    id="signup" value="signup">
                                                Save &amp; Continue
                                            </button>
                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                        <div id="OR" class="hidden-xs">
                            OR
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="row text-center sign-with">
                            <div class="col-md-12">
                                <h3>
                                    Sign in with</h3>
                            </div>
                            <div class="col-md-12">
                                <div class="btn-group btn-group-justified">
                                    <a href="#" class="btn btn-primary">Facebook</a> <a href="#" class="btn btn-danger">
                                    Google</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


</body>
</html>